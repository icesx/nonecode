HTTP
===

## HTTPS

### SSL/TSL

1. 服务端有非对称加密的公钥 A1 ,私钥 A2 。
2. 客户端发起请求,服务端将公钥 A1 返回给客户端。
3. 客户端随机生成一个对称加密的密钥 K ,用公钥 A1 加密后发送给服务端。
4. 服务端收到密文后用自己的私钥 A2 解密,得到对称密钥 K ,此时完成了安全的对称密
   钥交换,解决了对称加密时密钥传输被人窃取的问题。
5. 之后双方通信都使用密钥 K 进行对称加解密。

### 加解密

一般公钥用于加密，私钥用于解密。

>当客户端发起连接请求,服务端将公钥传输过去,客户端利用公钥加密好信息,再将
>密文发送给服务端,服务端里有私钥可以解密。

#### 为何不用私钥加密

>当服务端要返回数据,如果用公钥加密,那么客户端并没有私钥用来解密,而如果用私钥加密,客户端虽然有公钥可以解密，但这个公钥之前就在互联网上传输过,很有可能已经有人拿到,并不安全,所以这一过程只用非对称加密是不能满足的。
>
>**注意,严格来讲,私钥并不能用来加密,只能用作签名使用,这是由于密码学中生成公钥私钥时对不同变量的数学要求是不同的。**

### 签名

私钥一般用于签名

### SSL下的中间人攻击

如果没有CA机构，那么仍然可以中间人攻击

> 非对称加密的算法都是公开的,所有人都可以自己生成一对公钥私钥。当服务端向客户端返回公钥 A1 的时候,中间人将其替换成自己的公钥 B1 传送给浏览器。而浏览器此时一无所知,傻乎乎地使用公钥 B1 加密了密钥 K 发送出去,又被中间人截获。中间人利用自己的私钥 B2 解密,得到密钥 K ,再使用服务端的公钥 A1 加密传送给服务端,完成了通信链路,而服务端和客户端毫无感知。



> **出现这一问题的核心原因是客户端无法确认收到的公钥是不是真的是服务端发来的。**
>
> 为了解决这个问题,互联网引入了一个公信机构,这就是 CA

### CA 机构的作用

> 1. 服务端在使用 HTTPS 前,去经过认证的 CA 机构申请颁发一份数字证书,数字证书里包含有
>    证书持有者、证书有效期、公钥等信息。
> 2. 服务端将证书发送给客户端,客户端校验证书身份和要访问的网站身份确实一致后再进行后
>    续的加密操作。
> 3. 但是如果中间人也聪明一点,只改动了证书中的公钥部分,客户端依然不能确认证书是否
>    被篡改,这时我们就需要一些防伪技术了，即证书签名



#### 证书校验过程

> 1. CA 机构拥有自己的一对公钥和私钥。机构在颁发证书时对证书明文信息进行哈希。将哈希值用私钥进行加签,得到数字签名。
> 2. 明文数据和数字签名组成证书,传递给客户端:客户端得到证书,分解成明文部分 Text 和数字签名 Sig1 。
>    用 CA 机构的公钥进行解签,得到 Sig2( 由于 CA 机构是一种公信身份,因此在系统或浏览器中会内置 CA 机构的证书和公钥信息 ) 。
> 3. 用证书里声明的哈希算法对明文 Text 部分进行哈希得到 H 。当自己计算得到的哈希值 T 与解签后的 Sig2 相等,表示证书可信,没有被篡改。这时,签名是由 CA 机构的私钥生成的,中间人篡改信息后无法拿到 CA 机构的私钥,保证了证书可信。



> 注意,这里有一个比较难以理解的地方,非对称加密的签名过程是,私钥将一段消息进行加签,然后将签名部分和消息本身一起发送给对方。收到消息后对签名部分利用公钥验签,如果验签出来的内容和消息本身一致,表明消息没有被篡改。在这个过程中,系统或浏览器中内置的 CA 机构的证书和公钥成为了至关重要的环节,这也是 CA 机构公信身份的证明,如果系统或浏览器中没有这个 CA 机构,那么客户端可以不接
> 受服务端传回的证书,显示 HTTPS 警告。
>
> 实际上 CA 机构的证书是一条信任链, A 信任 B , B 信任 C ,以掘金的证书为例,掘金向
> RapidSSL 申请一张证书,而 RapidSSL 的 CA 身份是由 DigiCert Global 根 CA 认证的,构成
> 了一条信任链。



> 各级 CA 机构的私钥是绝对的私密信息,一旦 CA 机构的私钥泄露,其公信力就会一败涂
> 地。之前就有过几次 CA 机构私钥泄露,引发信任危机,各大系统和浏览器只能纷纷吊销内置的
> 对应 CA 的根证书。



> 有些老旧的网站会要求使用前下载安装他自己的根证书,这就是这个网站使用的证书并不能
> 在系统内置的 CA 机构和根证书之间形成一条信任链,需要自己安装根证书来构成信任链,
> 这里的⻛险就要使用者自己承担了

## HTTP2

> HTTP2主要通过创建一个浏览器、服务器之间的永久连接来提高速度,而不是每个信息都创建一个连接。这显著地降低了需要传输的数据量。
>
> 另外,它使用二进制来传输数据而不是文件,二进制是电脑语言。这意味着你的电脑不需要浪费时间将信息翻译为它能够理解的形式。
>
> HTTP/2 的其他特性包括”多路复用“(同时发送和接收多文本),优先级的使用(更
> 重要的数据优先传输),压缩(将信息压缩成更小的块)以及”服务器推送“,服务器将学
> 习猜测你下一个请求是什么,并提前发送数据。



